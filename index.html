function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  movePlayer();
  updateBullets();
  updateEnemies();
  handleCollisions();
  requestAnimationFrame(gameLoop);
}

function movePlayer() {
  if (keys.left && player.x > 0) player.x -= player.speed;
  if (keys.right && player.x < canvas.width - player.width) player.x += player.speed;
}

function updateBullets() {
  bullets.forEach((bullet, index) => {
    bullet.y -= 5;
    if (bullet.y < 0) bullets.splice(index, 1);
  });
}

function spawnEnemies() {
  enemies.length = 0;  // Reset enemies
  for (let i = 0; i < 5; i++) {
    enemies.push({ x: 100 + i * 60, y: 50, width: 30, height: 30 });
  }
}

function enemyFire() {
  if (enemies.length > 0) {
    let shooter = enemies[Math.floor(Math.random() * enemies.length)];
    enemyBullets.push({ x: shooter.x + 15, y: shooter.y + 30, width: 5, height: 10 });
  }
}

function updateEnemies() {
  enemies.forEach(enemy => {
    ctx.fillStyle = 'red';
    ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
  });
}

function startGame() {
  document.querySelector('.menu').style.display = 'none';
  canvas.style.display = 'block';
  endgameScreen.style.display = 'none';
  resizeCanvas();
  spawnEnemies();
  gameLoop();
  setInterval(enemyFire, enemyFireRate);
}
